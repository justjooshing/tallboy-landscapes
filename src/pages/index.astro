---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import ContactFooter from "../components/ContactFooter.astro";
import { getHomePageContent } from "../lib/homepage/index";
import { getServices } from "../lib/services/index";
import { getTestimonials } from "../lib/testimonials/index";
import { getHeroJobs } from "../lib/jobs/index";
import { getStats } from "../lib/stats/index";

const homeContent = await getHomePageContent();
const services = await getServices();
const testimonials = await getTestimonials();
const heroJobs = await getHeroJobs();
const stats = await getStats();

// Fallback content if Contentful is not configured
const heroImage =
  homeContent?.fields.heroImage?.fields.file?.url ||
  "/images/tallboylandscapes.jpg";
const heroTitle = homeContent?.fields.heroTitle;
const heroSubtitle = homeContent?.fields.heroSubtitle;
const aboutTitle = homeContent?.fields.aboutTitle;
const aboutDescriptions = homeContent?.fields.aboutDescription.split("\n\n");
const servicesTitle = homeContent?.fields.servicesTitle;
const testimonialTitle = homeContent?.fields.testimonialTitle;
const featuredJobsTitle = homeContent?.fields.featuredJobsTitle;
---

<Layout title="Tallboy Landscapes - Professional Landscaping Services">
  <Header />

  <main>
    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-image-wrapper">
        <img
          src={heroImage || "/placeholder.svg"}
          alt="Beautiful landscaping"
          class="hero-image"
        />
        <div class="hero-overlay"></div>
      </div>
      <div class="hero-content">
        <div class="container">
          <h1 class="hero-title">{heroTitle}</h1>
          <p class="hero-subtitle">{heroSubtitle}</p>
          <a href="#contact" class="hero-cta">Get a Free Quote</a>
        </div>
      </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about">
      <div class="container">
        <div class="about-content">
          <div class="about-text">
            <h2>{aboutTitle}</h2>
            {
              aboutDescriptions?.map((aboutDescription) => (
                <p>{aboutDescription}</p>
              ))
            }
          </div>
          {
            !!stats?.length ? (
              <div class="about-stats">
                {stats.map(({ fields: { value, label } }) => (
                  <div class="stat">
                    <span class="stat-number">{value}</span>
                    <span class="stat-label">{label}</span>
                  </div>
                ))}
              </div>
            ) : null
          }
        </div>
      </div>
    </section>

    <!-- Services Section -->
    {
      !!services?.length ? (
        <section id="services" class="services">
          <div class="container">
            <h2 class="section-title">{servicesTitle}</h2>
            <div class="services-grid">
              {services.map((service) => (
                <div class="service-card">
                  <div class="service-icon">{service.fields.icon || "ðŸŒ¿"}</div>
                  <h3>{service.fields.title}</h3>
                  <p>{service.fields.description}</p>
                </div>
              ))}
            </div>
          </div>
        </section>
      ) : null
    }

    <!-- Featured Projects Preview -->
    {
      !!heroJobs.length ? (
        <section class="featured-projects">
          <div class="container">
            <h2 class="section-title">{featuredJobsTitle}</h2>
            <div class="projects-grid">
              {heroJobs.map((job) => (
                <a href={`/jobs/${job.fields.slug}`} class="project-card">
                  <div class="project-image-wrapper">
                    <img
                      src={
                        job.fields.showcaseImage?.fields.file?.url ||
                        "/placeholder.svg"
                      }
                      alt={job.fields.title}
                      class="project-image"
                    />
                  </div>
                  <div class="project-info">
                    <h3>{job.fields.title}</h3>
                    <p class="project-location">{job.fields.location}</p>
                  </div>
                </a>
              ))}
            </div>
          </div>
        </section>
      ) : null
    }

    <!-- Testimonials Section -->
    {
      !!testimonials.length && (
        <section class="testimonials">
          <div class="container">
            <h2 class="section-title">{testimonialTitle}</h2>
            <div class="testimonials-grid">
              {testimonials.map((testimonial) => (
                <div class="testimonial-card">
                  <p class="testimonial-content">
                    "{testimonial.fields.feedback}"
                  </p>
                  <div class="testimonial-author">
                    <p class="author-name">{testimonial.fields.name}</p>
                    {testimonial.fields.role && (
                      <p class="author-role">{testimonial.fields.role}</p>
                    )}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </section>
      )
    }

    <!-- Contact Section -->
    <section id="contact">
      <ContactFooter />
    </section>
  </main>
</Layout>

<style>
  /* Hero Section */

  section {
    scroll-margin-top: 40px;
  }
  .hero {
    position: relative;
    height: 90vh;
    min-height: 600px;
    display: flex;
    align-items: center;
    overflow: hidden;
  }

  .hero-image-wrapper {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .hero-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .hero-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.3),
      rgba(45, 58, 46, 0.6)
    );
  }

  .hero-content {
    position: relative;
    z-index: 1;
    width: 100%;
    color: white;
  }

  .hero-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    text-wrap: balance;
  }

  .hero-subtitle {
    font-size: 1.25rem;
    margin-bottom: 2rem;
    opacity: 0.95;
    max-width: 600px;
  }

  .hero-cta {
    display: inline-block;
    background: var(--sage-green);
    color: white;
    padding: 1rem 2.5rem;
    border-radius: 6px;
    font-weight: 600;
    font-size: 1.05rem;
    transition: all 0.3s;
  }

  .hero-cta:hover {
    background: var(--terracotta);
    transform: translateY(-2px);
  }

  /* About Section */
  .about {
    padding: 5rem 0;
    background: white;
  }

  .about-content {
    display: grid;
    gap: 3rem;
  }

  .about-text h2 {
    font-size: 2.25rem;
    margin-bottom: 1.5rem;
    color: var(--dark-earth);
  }

  .about-text p {
    font-size: 1.1rem;
    line-height: 1.7;
    margin-bottom: 1rem;
    color: var(--charcoal);
  }

  .about-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 2rem;
    height: fit-content;
  }

  .stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 1.5rem;
    background: var(--cream);
    border-radius: 8px;
  }

  .stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--sage-green);
    font-family: var(--font-display);
  }

  .stat-label {
    font-size: 0.95rem;
    color: var(--charcoal);
    margin-top: 0.5rem;
  }

  /* Services Section */
  .services {
    padding: 5rem 0;
    background: var(--cream);
  }

  .section-title {
    font-size: 2.25rem;
    text-align: center;
    margin-bottom: 3rem;
    color: var(--dark-earth);
  }

  .services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
  }

  .service-card {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    transition:
      transform 0.3s,
      box-shadow 0.3s;
  }

  .service-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  }

  .service-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .service-card h3 {
    font-size: 1.5rem;
    margin-bottom: 0.75rem;
    color: var(--dark-earth);
  }

  .service-card p {
    color: var(--charcoal);
    line-height: 1.6;
  }

  /* Featured Projects */
  .featured-projects {
    padding: 5rem 0;
    background: white;
  }

  .projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .project-card {
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.3s;
    background: var(--cream);
  }

  .project-card:hover {
    transform: translateY(-5px);
  }

  .project-image-wrapper {
    aspect-ratio: 4/3;
    overflow: hidden;
  }

  .project-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
  }

  .project-card:hover .project-image {
    transform: scale(1.05);
  }

  .project-info {
    padding: 1.5rem;
  }

  .project-info h3 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--dark-earth);
  }

  .project-location {
    color: var(--sage-green);
    font-weight: 500;
  }

  /* Testimonials Section */
  .testimonials {
    padding: 5rem 0;
    background: var(--cream);
  }

  .testimonials-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .testimonial-card {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    border-left: 4px solid var(--sage-green);
  }

  .testimonial-content {
    font-size: 1.05rem;
    line-height: 1.7;
    margin-bottom: 1.5rem;
    font-style: italic;
    color: var(--charcoal);
  }

  .author-name {
    font-weight: 600;
    color: var(--dark-earth);
    margin-bottom: 0.25rem;
  }

  .author-role {
    font-size: 0.9rem;
    color: var(--sage-green);
  }

  @media (min-width: 768px) {
    .hero-title {
      font-size: 3.5rem;
    }

    .hero-subtitle {
      font-size: 1.5rem;
    }

    .about-content {
      grid-template-columns: 1.5fr 1fr;
      gap: 4rem;
    }
  }

  @media (min-width: 1024px) {
    .hero-title {
      font-size: 4.5rem;
    }

    .services-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
</style>
